# BunkerWeb Malware Scan Plugin - Configuration Variables
# Version: 0.7.0
# Copy to /etc/bunkerweb/variables.env and customize

# ============================================================================
# CORE SETTINGS
# ============================================================================

MALWARE_SCAN_ENABLED=yes                                   # Enable malware scanning
MALWARE_SCAN_DEBUG=no                                      # Enable debug logging (disable in production)

# ============================================================================
# CLAMAV SETTINGS
# ============================================================================

MALWARE_SCAN_CLAMAV_HOST=127.0.0.1                        # ClamAV daemon host
MALWARE_SCAN_CLAMAV_PORT=3310                             # ClamAV daemon port
MALWARE_SCAN_CLAMAV_TIMEOUT=10000                         # ClamAV connection timeout (ms)
MALWARE_SCAN_CLAMAV_MAX_SIZE=26214400                     # Max file size for ClamAV (25MB)
MALWARE_SCAN_HASH_MAX_SIZE=67108864                       # Max file size for hash scanners (64MB)

# ============================================================================
# ALLOW LIST (FALSE POSITIVE HANDLING) - v0.4.1+
# ============================================================================

MALWARE_SCAN_ALLOWLIST_HASHES=                            # Comma-separated SHA256 hashes to skip scanning
MALWARE_SCAN_ALLOWLIST_FILE=                              # Path to file with SHA256 hashes (one per line)

# ============================================================================
# MULTI-LAYER SCANNING
# ============================================================================

MALWARE_SCAN_SKIP_OTHERS_ON_CLAMAV_DETECT=no              # Skip cloud scanners if ClamAV detects (faster response)
MALWARE_SCAN_RESUME_SCAN_ON_FIRST_HIT=no                  # WARNING: DOS risk! Continue scanning after detection
MALWARE_SCAN_BLOCK_ON_FILENAME_INJECTION_ATTACK=yes       # Block on filename injection (path traversal, null bytes)
MALWARE_SCAN_SCAN_FULL_MULTIPART_BODY=no                  # Scan full multipart body (not recommended - random boundaries prevent caching)

# ============================================================================
# VIRUSTOTAL (70+ AV ENGINES + ML)
# ============================================================================

MALWARE_SCAN_API_USE_VIRUSTOTAL=yes                           # Enable VirusTotal scanning
MALWARE_SCAN_API_VIRUSTOTAL_KEY=                          # VirusTotal API key (REQUIRED)
MALWARE_SCAN_API_VIRUSTOTAL_SUSPICIOUS=5                  # Suspicious if N+ engines flag
MALWARE_SCAN_API_VIRUSTOTAL_MALICIOUS=3                   # Malicious if N+ engines flag
MALWARE_SCAN_API_VIRUSTOTAL_UPLOAD_UNKNOWN=yes            # Upload unknown malware to VirusTotal
MALWARE_SCAN_API_VIRUSTOTAL_AUTO_VOTE=yes                 # Auto-vote on uploaded files
MALWARE_SCAN_API_VIRUSTOTAL_MAX_UPLOAD_SIZE=33554432      # Max file size for VT upload (32MB)

# ============================================================================
# THREATFOX (COMMUNITY IOC DATABASE)
# ============================================================================

MALWARE_SCAN_API_USE_THREATFOX=yes                            # Enable ThreatFox scanning
MALWARE_SCAN_API_THREATFOX_KEY=                           # ThreatFox API key (REQUIRED)

# ============================================================================
# SENTINELONE (ENTERPRISE THREAT INTELLIGENCE)
# ============================================================================

MALWARE_SCAN_API_USE_SENTINELONE=yes                          # Enable SentinelOne scanning
MALWARE_SCAN_API_SENTINELONE_URL=                         # SentinelOne console URL (REQUIRED)
MALWARE_SCAN_API_SENTINELONE_TOKEN=                       # SentinelOne API token (REQUIRED)

# ============================================================================
# THREAT INTELLIGENCE SHARING
# ============================================================================

MALWARE_SCAN_SHARE_FILES=no                               # Share detected files with VirusTotal (privacy/legal implications)

# ============================================================================
# WEBHOOK NOTIFICATIONS
# ============================================================================

MALWARE_SCAN_TEAMS_WEBHOOK_URL=                           # Microsoft Teams webhook URL
MALWARE_SCAN_TEAMS_WEBHOOK_RATE_LIMIT=3                   # Teams notifications per minute (max: 200)
MALWARE_SCAN_DISCORD_WEBHOOK_URL=                         # Discord webhook URL
MALWARE_SCAN_DISCORD_WEBHOOK_RATE_LIMIT=3                 # Discord notifications per minute (max: 30)
# MALWARE_SCAN_UNMASK_KEYS=I_WANT_TO_LEAK_MY_SECRETS_TO_LOG  # Show full URLs in logs (SECURITY RISK - debugging only)

# ============================================================================
# ATTACKER TRACKING
# ============================================================================

MALWARE_SCAN_TRACK_ATTACKERS=yes                          # Track IPs that upload malware
MALWARE_SCAN_TRACK_ATTACKER_TTL=7776000                   # Track duration (90 days)

# ============================================================================
# CACHING
# ============================================================================

MALWARE_SCAN_USE_SHARED_DATABASE=yes                      # Enable Redis shared cache for clusters
MALWARE_SCAN_CACHE_VIRUS_TTL=7776000                      # Local cache TTL for malicious results (90 days)
MALWARE_SCAN_CACHE_CLEAN_TTL=300                          # Local cache TTL for clean results (5 minutes)
MALWARE_SCAN_CACHE_SHARED_TTL=21600                       # Redis cache TTL (6 hours)
MALWARE_SCAN_REDIS_CIRCUIT_BREAKER_MAX_BACKOFF=8          # Redis circuit breaker max backoff (seconds)
MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_ALL=no              # Clear ALL caches on restart (master switch)
MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_CLAMAV=no           # Clear ClamAV cache (useful after signature updates)
MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_VIRUSTOTAL=no       # Clear VirusTotal cache
MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_THREATFOX=no        # Clear ThreatFox cache
MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_SENTINELONE=no      # Clear SentinelOne cache
MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_ATTACKER_IPV4=no    # Clear IPv4 attacker tracking
MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_ATTACKER_IPV6=no    # Clear IPv6 attacker tracking

# ============================================================================
# FILE CLEANUP
# ============================================================================

MALWARE_SCAN_CLEANUP_FILES=yes                            # Auto-cleanup detected malware files
MALWARE_SCAN_CLEANUP_ORPHANED=yes                         # Cleanup orphaned temp files (workers only)
MALWARE_SCAN_CLEANUP_AGE=3600                             # Cleanup files older than N seconds (1 hour)

# ============================================================================
# MEMORY UPLOADS
# ============================================================================

MALWARE_SCAN_BLOCK_MEMORY_UPLOADS=yes                     # Block uploads buffered in memory (can't be scanned)

# ============================================================================
# NOTES
# ============================================================================

# - Replace empty values with actual API keys/URLs before use
# - For clusters: Deploy plugin files to ALL nodes (manager + workers)
# - SECURITY: Store this file as /etc/bunkerweb/variables.env with chmod 600
# - Allow list (v0.4.1+): Use in-memory caching for 50-200x faster lookups
# - Cleanup runs on workers only (they handle file uploads)
# - See all-features-enabled.md for detailed documentation
