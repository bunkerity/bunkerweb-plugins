{
  "id": "malware-scan",
  "name": "Malware Scanner",
  "description": "Scan uploaded files for malware",
  "version": "0.8.0",
  "stream": "no",
  "ui": true,
  "jobs": [
    {
      "name": "malware-scan-cache-cleanup",
      "file": "malware-scan-cache-cleanup.py",
      "every": "once",
      "reload": false,
      "async": true
    },
    {
      "name": "malware-scan-update",
      "file": "malware-scan-update.py",
      "every": "hour",
      "reload": false
    }
  ],
  "settings": {
    "USE_MALWARE_SCANNER": {
      "context": "global",
      "default": "no",
      "help": "Enable malware scanning for file uploads",
      "id": "use-malware-scanner",
      "label": "Enable malware scanning",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_DEBUG": {
      "context": "global",
      "default": "no",
      "help": "Enable detailed debug logging (shows every operation step, byte analysis, pattern matching). Only enable for troubleshooting as it generates verbose logs.",
      "id": "malware-scan-debug",
      "label": "Debug mode",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CLAMAV_HOST": {
      "context": "global",
      "default": "127.0.0.1",
      "help": "ClamAV server hostname or IP address",
      "id": "malware-scan-clamav-host",
      "label": "ClamAV host",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_CLAMAV_PORT": {
      "context": "global",
      "default": "3310",
      "help": "ClamAV server TCP port",
      "id": "malware-scan-clamav-port",
      "label": "ClamAV port",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CLAMAV_TIMEOUT": {
      "context": "global",
      "default": "10000",
      "help": "ClamAV connection timeout in milliseconds",
      "id": "malware-scan-clamav-timeout",
      "label": "ClamAV timeout (ms)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CLAMAV_MAX_SIZE": {
      "context": "global",
      "default": "26214400",
      "help": "Maximum file size (in bytes) for ClamAV scanning via INSTREAM. Files larger than this will skip ClamAV scan but continue with hash-based scanners. Default: 25MB (26214400 bytes). Should match or be less than ClamAV's StreamMaxLength setting (default 25M on Debian).",
      "id": "malware-scan-clamav-max-size",
      "label": "ClamAV max file size (bytes)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_HASH_MAX_SIZE": {
      "context": "global",
      "default": "67108864",
      "help": "Maximum file size (in bytes) for hash-based scanning (MalwareBazaar, VirusTotal, SentinelOne). Files larger than this will skip SHA256 calculation and hash-based scanners to avoid performance issues with large files like ISOs. Default: 64MB (67108864 bytes). ClamAV scan is unaffected by this limit.",
      "id": "malware-scan-hash-max-size",
      "label": "Hash scan max file size (bytes)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_MAX_FILES_PER_REQUEST": {
      "context": "global",
      "default": "100",
      "help": "Maximum number of files allowed in a single multipart upload request. Prevents resource exhaustion (file descriptor depletion) via DoS attacks with many small files. Default: 100 files. Requests exceeding this limit are blocked immediately.",
      "id": "malware-scan-max-files-per-request",
      "label": "Max files per request",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_ALLOWLIST_HASHES": {
      "context": "global",
      "default": "",
      "help": "SHA256 hashes of known-good files to skip scanning (for false positive handling). Comma-separated list of full SHA256 hashes (64 hex characters each). Files matching these hashes will skip all scanning (ClamAV, MalwareBazaar, VirusTotal, SentinelOne) and be cached as clean. Example: abc123...,def456... Use this for legitimate files incorrectly flagged as malware. For large lists, use MALWARE_SCAN_ALLOWLIST_FILE instead. Leave empty to scan all files.",
      "id": "malware-scan-allowlist-hashes",
      "label": "Allow list SHA256 hashes (comma-separated)",
      "regex": "^([a-fA-F0-9]{64}(,[a-fA-F0-9]{64})*)?$",
      "type": "text"
    },
    "MALWARE_SCAN_ALLOWLIST_FILE": {
      "context": "global",
      "default": "",
      "help": "Path to file containing SHA256 hashes of known-good files to skip scanning (for false positive handling). File format: one SHA256 hash per line (64 hex characters), blank lines and lines starting with # are ignored. Files matching these hashes will skip all scanning (ClamAV, MalwareBazaar, VirusTotal, SentinelOne) and be cached as clean. Use this for large allow lists. Leave empty to disable file-based allow list.",
      "id": "malware-scan-allowlist-file",
      "label": "Allow list file path",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_BLOCK_MEMORY_UPLOADS": {
      "context": "global",
      "default": "no",
      "help": "Block uploads that are buffered in memory instead of files (cannot scan memory uploads)",
      "id": "malware-scan-block-memory",
      "label": "Block memory uploads",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CLEANUP_FILES": {
      "context": "global",
      "default": "yes",
      "help": "Automatically delete temporary files after scanning",
      "id": "malware-scan-cleanup",
      "label": "Cleanup temp files",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CLEANUP_ORPHANED": {
      "context": "global",
      "default": "no",
      "help": "Clean up orphaned temporary files on worker start",
      "id": "malware-scan-cleanup-orphaned",
      "label": "Cleanup orphaned files",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CLEANUP_AGE": {
      "context": "global",
      "default": "3600",
      "help": "Maximum age (in seconds) for temporary files before cleanup",
      "id": "malware-scan-cleanup-age",
      "label": "Cleanup age (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_USE_SHARED_DATABASE": {
      "context": "global",
      "default": "yes",
      "help": "Enable Redis shared cache for scan results across cluster nodes. Automatically disabled if BunkerWeb's global USE_REDIS is disabled. Improves performance in multi-node deployments by sharing scan results between workers.",
      "id": "malware-scan-use-shared-database",
      "label": "Use Redis shared cache",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CACHE_VIRUS_TTL": {
      "context": "global",
      "default": "7776000",
      "help": "Cache duration (in seconds) for malicious scan results (all scanners). Default: 90 days (7776000 seconds). Extended retention improves performance by avoiding re-scanning of known malware, reduces API calls to external scanners (VirusTotal, SentinelOne), and maintains detection history. Malware file hashes (SHA256) rarely change, making long-term caching safe and beneficial.",
      "id": "malware-scan-cache-virus-ttl",
      "label": "Malicious scan cache TTL (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CACHE_CLEAN_TTL": {
      "context": "global",
      "default": "300",
      "help": "Cache duration (in seconds) for clean scan results. Shorter than malicious TTL to quickly detect newly-identified threats. Default: 5 minutes (300 seconds). This implements differential caching for security.",
      "id": "malware-scan-cache-clean-ttl",
      "label": "Clean scan cache TTL (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CACHE_ERROR_TTL": {
      "context": "global",
      "default": "60",
      "help": "Cache duration (in seconds) for scanner errors and failures. Prevents repeated failed scan attempts while allowing quick retry. Errors cached include scanner timeouts, connection failures, and service unavailability. Default: 60 seconds.",
      "id": "malware-scan-cache-error-ttl",
      "label": "Error cache TTL (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CACHE_LOCK_TTL": {
      "context": "global",
      "default": "60",
      "help": "Lock duration (in seconds) for atomic cache operations across all scanners (ClamAV, MalwareBazaar, VirusTotal, SentinelOne). Prevents race conditions when multiple requests scan/query the same file concurrently. Lock automatically expires to prevent deadlocks if scanning process crashes. Default: 60 seconds.",
      "id": "malware-scan-cache-lock-ttl",
      "label": "Cache lock TTL (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CACHE_WAIT_TIMEOUT": {
      "context": "global",
      "default": "30000",
      "help": "Maximum wait time (in milliseconds) for concurrent requests waiting for scan/query results across all scanners. If another request is scanning/querying the same file, wait up to this duration for the result before falling back to scanning/querying independently. Applies to ClamAV, MalwareBazaar, VirusTotal, and SentinelOne. Default: 30 seconds (30000 ms).",
      "id": "malware-scan-cache-wait-timeout",
      "label": "Cache wait timeout (ms)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CACHE_SHARED_TTL": {
      "context": "global",
      "default": "21600",
      "help": "Cache duration (in seconds) for scan results stored in Redis (shared across cluster). Longer than local cache to benefit from cluster-wide knowledge. Default: 6 hours (21600 seconds).",
      "id": "malware-scan-cache-shared-ttl",
      "label": "Redis shared cache TTL (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_REDIS_CIRCUIT_BREAKER_MAX_BACKOFF": {
      "context": "global",
      "default": "8",
      "help": "Maximum backoff time (in seconds) for Redis circuit breaker. Circuit breaker uses exponential backoff starting at 1ms (2ms, 4ms, 8ms, 16ms, 32ms, 64ms, 128ms, 256ms, 512ms, 1s, 2s, 4s, up to this max). Protects against Redis outages by temporarily skipping Redis operations. Default: 8 seconds.",
      "id": "malware-scan-redis-circuit-breaker-max-backoff",
      "label": "Redis circuit breaker max backoff (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_API_USE_VIRUSTOTAL": {
      "context": "global",
      "default": "no",
      "help": "Enable VirusTotal API integration for cloud-based scanning. Can be used together with ClamAV (dual-layer) or independently (VirusTotal-only mode by disabling ClamAV)",
      "id": "malware-scan-api-use-virustotal",
      "label": "Enable VirusTotal",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_SKIP_OTHERS_ON_CLAMAV_DETECT": {
      "context": "global",
      "default": "yes",
      "help": "Skip cloud scanner checks (MalwareBazaar, VirusTotal, SentinelOne) if ClamAV already detected malware (faster blocking). Disable to get additional cloud analysis even after ClamAV detection.",
      "id": "malware-scan-skip-others-clamav",
      "label": "Skip cloud scanners if ClamAV detects",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_RESUME_SCAN_ON_FIRST_HIT": {
      "context": "global",
      "default": "no",
      "help": "WARNING: Possible denial of service risk. When malware is detected, continue scanning remaining files/scanners to collect comprehensive threat intelligence. Plugin performs dual scanning: (1) entire multipart body to catch malware split across boundaries, (2) individual files. Resume mode collects all detections before blocking. Default: no (block immediately on first detection).",
      "id": "malware-scan-resume-on-first-hit",
      "label": "Resume scan on first hit (DOS risk)",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_BLOCK_ON_FILENAME_INJECTION_ATTACK": {
      "context": "global",
      "default": "yes",
      "help": "Block filename injection attacks (path traversal, null bytes). Behavior depends on RESUME_SCAN_ON_FIRST_HIT: (1) BLOCK=yes, RESUME=yes: Skip file, scan others, block at end. (2) BLOCK=yes, RESUME=no: Block immediately (default). (3) BLOCK=no, RESUME=yes: Log, scan content, continue. (4) BLOCK=no, RESUME=no: Log, scan until detection. When BLOCK=no, file content is still scanned for malware. Default: yes (immediate blocking).",
      "id": "malware-scan-block-on-filename-injection",
      "label": "Block on filename injection attack",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_SCAN_FULL_MULTIPART_BODY": {
      "context": "global",
      "default": "no",
      "help": "Enable full multipart body scan (in addition to individual file extraction). WARNING: Full body SHA256 changes on every upload due to random HTTP boundary strings, making caching ineffective and wasting ClamAV resources. Individual file extraction always occurs regardless of this setting. Keep disabled (no) unless you suspect malware split across multipart boundaries. Default: no (skip full body scan, extract and scan individual files only).",
      "id": "malware-scan-scan-full-multipart-body",
      "label": "Scan full multipart body (not recommended)",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_API_VIRUSTOTAL_KEY": {
      "context": "global",
      "default": "",
      "help": "VirusTotal API key for authentication",
      "id": "malware-scan-api-virustotal-key",
      "label": "VirusTotal API key",
      "regex": "^.*$",
      "type": "password"
    },
    "MALWARE_SCAN_API_VIRUSTOTAL_SUSPICIOUS": {
      "context": "global",
      "default": "5",
      "help": "Minimum number of suspicious reports before considering file as malicious",
      "id": "malware-scan-api-virustotal-suspicious",
      "label": "Suspicious threshold",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_API_VIRUSTOTAL_MALICIOUS": {
      "context": "global",
      "default": "3",
      "help": "Minimum number of malicious reports before considering file as malicious",
      "id": "malware-scan-api-virustotal-malicious",
      "label": "Malicious threshold",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_API_VIRUSTOTAL_UPLOAD_UNKNOWN": {
      "context": "global",
      "default": "no",
      "help": "\u26a0\ufe0f GDPR WARNING: Upload complete malware files to VirusTotal if ClamAV detects malware but file is unknown to VT. FILES BECOME PUBLICLY ACCESSIBLE in VirusTotal's database and may contain personal data (documents, emails, images). Default: DISABLED for GDPR compliance. Only enable if you have proper legal basis, user consent, and documented justification. See GDPR.md for full implications.",
      "id": "malware-scan-api-virustotal-upload-unknown",
      "label": "Upload unknown malware to VT",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_API_VIRUSTOTAL_AUTO_VOTE": {
      "context": "global",
      "default": "no",
      "help": "Automatically vote on files uploaded to VirusTotal. If a file was uploaded (unknown to VT) and ClamAV detected it as malware, automatically add a 'malicious' vote.",
      "id": "malware-scan-api-virustotal-auto-vote",
      "label": "Auto-vote on uploaded files",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_API_VIRUSTOTAL_MAX_UPLOAD_SIZE": {
      "context": "global",
      "default": "33554432",
      "help": "Maximum file size (in bytes) for uploading to VirusTotal. Default is 32MB (33554432 bytes), which is VirusTotal's limit for standard API.",
      "id": "malware-scan-api-virustotal-max-upload-size",
      "label": "Max VT upload size (bytes)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_SHARE_FILES": {
      "context": "global",
      "default": "no",
      "help": "Share detected malware files with threat intelligence platforms (currently VirusTotal) when any scanner (ClamAV, MalwareBazaar, SentinelOne) detects malware but the file is unknown to the platform. Helps improve global threat intelligence. Requires VirusTotal integration to be enabled. Only real malware is shared, not PUA.",
      "id": "malware-scan-share-files",
      "label": "Share detected malware files",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_VIRUSFILE_LOCAL_EXPORT_PATH": {
      "context": "global",
      "default": "",
      "help": "Local directory path to export detected malware samples for forensic analysis. Files are saved with SHA256 hash as filename. Example: /tmp/malware-scan/samples. Leave empty to disable local export. Directory will be created if it doesn't exist. Disk space is checked before saving to prevent filling the filesystem.",
      "id": "malware-scan-virusfile-local-export-path",
      "label": "Local malware export path",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_API_USE_SENTINELONE": {
      "context": "global",
      "default": "no",
      "help": "Enable SentinelOne API integration for threat intelligence lookup. Checks file hashes against SentinelOne's threat database. Can be used together with ClamAV and VirusTotal for multi-layer protection.",
      "id": "malware-scan-api-use-sentinelone",
      "label": "Enable SentinelOne",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_API_SENTINELONE_URL": {
      "context": "global",
      "default": "",
      "help": "SentinelOne Management Console URL (e.g., https://your-console.sentinelone.net). Required for SentinelOne integration.",
      "id": "malware-scan-api-sentinelone-url",
      "label": "SentinelOne Console URL",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_API_SENTINELONE_TOKEN": {
      "context": "global",
      "default": "",
      "help": "SentinelOne API token for authentication (REQUIRED). Generate from Console: POST /web/api/v2.0/users/generate-api-token",
      "id": "malware-scan-api-sentinelone-token",
      "label": "SentinelOne API token",
      "regex": "^.*$",
      "type": "password"
    },
    "MALWARE_SCAN_TEAMS_WEBHOOK_URL": {
      "context": "global",
      "default": "",
      "help": "Microsoft Teams webhook URL for malware detection notifications. Create an Incoming Webhook connector in Teams. Leave empty to disable Teams notifications.",
      "id": "malware-scan-teams-webhook-url",
      "label": "Teams webhook URL",
      "regex": "^.*$",
      "type": "password"
    },
    "MALWARE_SCAN_TEAMS_WEBHOOK_RATE_LIMIT": {
      "context": "global",
      "default": "3",
      "help": "Maximum Teams webhook notifications per minute. Microsoft Teams limit: 200/min. Set to 0 to use maximum (200). Default: 3/min.",
      "id": "malware-scan-teams-webhook-rate-limit",
      "label": "Teams rate limit (per min)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_DISCORD_WEBHOOK_URL": {
      "context": "global",
      "default": "",
      "help": "Discord webhook URL for malware detection notifications. Create a webhook in Discord channel settings. Leave empty to disable Discord notifications.",
      "id": "malware-scan-discord-webhook-url",
      "label": "Discord webhook URL",
      "regex": "^.*$",
      "type": "password"
    },
    "MALWARE_SCAN_DISCORD_WEBHOOK_RATE_LIMIT": {
      "context": "global",
      "default": "3",
      "help": "Maximum Discord webhook notifications per minute. Discord limit: 30/min. Set to 0 to use maximum (30). Default: 3/min.",
      "id": "malware-scan-discord-webhook-rate-limit",
      "label": "Discord rate limit (per min)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_ANONYMIZE_WEBHOOK_IPS": {
      "context": "global",
      "default": "yes",
      "help": "Anonymize IP addresses in webhook notifications for GDPR data minimization (Article 5(1)(c)). Masks last octet/group (192.168.1.123 -> 192.168.1.x) to provide network-level information without exposing full IPs to third parties (Microsoft Teams/Discord). Set to 'no' to send full IPs. Default: yes (recommended for GDPR compliance).",
      "id": "malware-scan-anonymize-webhook-ips",
      "label": "Anonymize IPs in webhooks",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_TRACK_ATTACKERS": {
      "context": "global",
      "default": "yes",
      "help": "Track IP addresses that upload malware to identify repeat offenders. Shows upload history in webhook notifications and logs. Data stored in cache with configurable TTL.",
      "id": "malware-scan-track-attackers",
      "label": "Track attacker IPs",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_TRACK_ATTACKER_TTL": {
      "context": "global",
      "default": "7776000",
      "help": "Duration (in seconds) to track attacker IP addresses. Default: 90 days (7776000 seconds). This extended retention period allows sufficient time to gather evidence for law enforcement and legal proceedings. After this period, the IP's malware upload history is cleared. TTL is reset on each new malware upload.",
      "id": "malware-scan-track-attacker-ttl",
      "label": "Attacker tracking TTL (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_ALL": {
      "context": "global",
      "default": "no",
      "help": "Clear ALL cached scan results on plugin startup/reload. Master switch that overrides individual scanner cleanup flags. Useful after signature updates. Clears both local and Redis caches.",
      "id": "malware-scan-cache-cleanup-on-restart-all",
      "label": "Clear all caches on restart",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_CLAMAV": {
      "context": "global",
      "default": "no",
      "help": "Clear ClamAV cached scan results on plugin startup/reload. Useful after ClamAV signature database updates. Ignored if cleanup_all is enabled.",
      "id": "malware-scan-cache-cleanup-on-restart-clamav",
      "label": "Clear ClamAV cache on restart",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_VIRUSTOTAL": {
      "context": "global",
      "default": "no",
      "help": "Clear VirusTotal cached scan results on plugin startup/reload. Use when you want fresh VirusTotal lookups. Ignored if cleanup_all is enabled.",
      "id": "malware-scan-cache-cleanup-on-restart-virustotal",
      "label": "Clear VirusTotal cache on restart",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_SENTINELONE": {
      "context": "global",
      "default": "no",
      "help": "Clear SentinelOne cached scan results on plugin startup/reload. Use when you want fresh SentinelOne threat intelligence. Ignored if cleanup_all is enabled.",
      "id": "malware-scan-cache-cleanup-on-restart-sentinelone",
      "label": "Clear SentinelOne cache on restart",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_MALWAREBAZAAR": {
      "context": "global",
      "default": "no",
      "help": "Clear MalwareBazaar cached scan results on plugin startup/reload. Use when you want fresh MalwareBazaar sample lookups. Ignored if cleanup_all is enabled.",
      "id": "malware-scan-cache-cleanup-on-restart-malwarebazaar",
      "label": "Clear MalwareBazaar cache on restart",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_ATTACKER_IPV4": {
      "context": "global",
      "default": "no",
      "help": "Clear IPv4 attacker tracking data on plugin startup/reload. Removes malware upload history for all tracked IPv4 addresses. Ignored if cleanup_all is enabled.",
      "id": "malware-scan-cache-cleanup-on-restart-attacker-ipv4",
      "label": "Clear IPv4 attacker tracking on restart",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CACHE_CLEANUP_ON_RESTART_ATTACKER_IPV6": {
      "context": "global",
      "default": "no",
      "help": "Clear IPv6 attacker tracking data on plugin startup/reload. Removes malware upload history for all tracked IPv6 addresses. Ignored if cleanup_all is enabled.",
      "id": "malware-scan-cache-cleanup-on-restart-attacker-ipv6",
      "label": "Clear IPv6 attacker tracking on restart",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_UNMASK_KEYS": {
      "context": "global",
      "default": "",
      "help": "SECURITY RISK: Set to 'I_WANT_TO_LEAK_MY_SECRETS_TO_LOG' to show full webhook URLs in logs (for debugging only). Leave empty to mask sensitive URLs.",
      "id": "malware-scan-unmask-keys",
      "label": "Unmask secrets in logs",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_MALWAREBAZAAR_HASH_LOOKUP": {
      "context": "global",
      "default": "yes",
      "help": "Enable MalwareBazaar hash database for instant malware detection (<1ms). Stores 1M+ malware hashes from abuse.ch in Redis for sub-millisecond lookups. Can be used alone or combined with ClamAV/VirusTotal/SentinelOne for multi-layer protection.",
      "id": "malware-scan-malwarebazaar-hash-lookup",
      "label": "Enable MalwareBazaar hash lookup",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_MALWAREBAZAAR_AUTO_UPDATE": {
      "context": "global",
      "default": "yes",
      "help": "Enable automatic scheduled updates of MalwareBazaar hash database. Uses BunkerWeb scheduler for hourly updates. Uses ETag caching to avoid downloading unchanged files (98% bandwidth savings). Updates from sysangels.ai mirror.",
      "id": "malware-scan-malwarebazaar-auto-update",
      "label": "Enable auto-updates",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_MALWAREBAZAAR_UPDATE_INTERVAL": {
      "context": "global",
      "default": "3600",
      "help": "Interval (in seconds) between automatic hash database updates. Default: 3600 (1 hour). Use 86400 (daily) for FULL strategy. Set to lower values for more frequent updates (300=5min, 600=10min, 3600=1hour).",
      "id": "malware-scan-malwarebazaar-update-interval",
      "label": "Update interval (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_MALWAREBAZAAR_UPDATE_URL_FULL": {
      "context": "global",
      "default": "https://bazaar.sysangels.ai/bunkerweb/malwarebazaar_full_split.zip",
      "help": "URL for downloading MalwareBazaar full hash database (ZIP format with 16 split CSV files). Default: sysangels.ai optimized mirror with pre-split files for faster parallel import.",
      "id": "malware-scan-malwarebazaar-update-url-full",
      "label": "Full hash database download URL",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_MALWAREBAZAAR_UPDATE_URL_RECENT": {
      "context": "global",
      "default": "https://bazaar.sysangels.ai/bunkerweb/malwarebazaar_recent_split.zip",
      "help": "URL for downloading MalwareBazaar recent hash database (ZIP format with 16 split CSV files, updated every 5 minutes). Contains hashes from past 24 hours.",
      "id": "malware-scan-malwarebazaar-update-url-recent",
      "label": "Recent hash database download URL",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_MALWAREBAZAAR_CSV_PATH": {
      "context": "global",
      "default": "/var/cache/bunkerweb/malware-scan/hashes.csv",
      "help": "Path to store downloaded MalwareBazaar hash CSV file. Directory must be writable by BunkerWeb process.",
      "id": "malware-scan-malwarebazaar-csv-path",
      "label": "Hash database CSV path",
      "regex": "^.*$",
      "type": "text"
    }
  }
}