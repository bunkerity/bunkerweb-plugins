{
  "id": "malware-scan",
  "name": "Malware Scanner",
  "description": "Scan uploaded files for malware using ClamAV. Works with HTTP/1.1, HTTP/2, and HTTP/3.",
  "version": "0.2.0",
  "stream": "no",
  "settings": {
    "MALWARE_SCAN_ENABLED": {
      "context": "multisite",
      "default": "no",
      "help": "Enable malware scanning for file uploads",
      "id": "use-malware-scan",
      "label": "Enable malware scanning",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_DEBUG": {
      "context": "multisite",
      "default": "no",
      "help": "Enable detailed debug logging (shows every operation step, byte analysis, pattern matching). Only enable for troubleshooting as it generates verbose logs.",
      "id": "malware-scan-debug",
      "label": "Debug mode",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_EXCLUDED_EXTENSIONS": {
      "context": "multisite",
      "default": "jpg,jpeg,png,gif,bmp,ico,webp,mp3,mp4,avi,mov,wmv,flv,webm,ogg,wav,flac",
      "help": "Comma-separated list of file extensions to skip scanning (e.g., jpg,png,gif). These file types are considered safe and will not be scanned to improve performance. SVG files are NOT excluded by default as they can contain JavaScript. Leave empty to scan all files.",
      "id": "malware-scan-excluded-extensions",
      "label": "Excluded file extensions",
      "regex": "^([a-zA-Z0-9]+,)*[a-zA-Z0-9]*$",
      "type": "text"
    },
    "MALWARE_SCAN_CLAMAV_HOST": {
      "context": "multisite",
      "default": "127.0.0.1",
      "help": "ClamAV server hostname or IP address",
      "id": "malware-scan-clamav-host",
      "label": "ClamAV host",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_CLAMAV_PORT": {
      "context": "multisite",
      "default": "3310",
      "help": "ClamAV server TCP port",
      "id": "malware-scan-clamav-port",
      "label": "ClamAV port",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CLAMAV_TIMEOUT": {
      "context": "multisite",
      "default": "10000",
      "help": "ClamAV connection timeout in milliseconds",
      "id": "malware-scan-clamav-timeout",
      "label": "ClamAV timeout (ms)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CLAMAV_MAX_SIZE": {
      "context": "multisite",
      "default": "26214400",
      "help": "Maximum file size (in bytes) for ClamAV scanning via INSTREAM. Files larger than this will skip ClamAV scan but continue with hash-based scanners. Default: 25MB (26214400 bytes). Should match or be less than ClamAV's StreamMaxLength setting (default 25M on Debian).",
      "id": "malware-scan-clamav-max-size",
      "label": "ClamAV max file size (bytes)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_HASH_MAX_SIZE": {
      "context": "multisite",
      "default": "67108864",
      "help": "Maximum file size (in bytes) for hash-based scanning (VirusTotal, ThreatFox, SentinelOne). Files larger than this will skip SHA256 calculation and hash-based scanners to avoid performance issues with large files like ISOs. Default: 64MB (67108864 bytes). ClamAV scan is unaffected by this limit.",
      "id": "malware-scan-hash-max-size",
      "label": "Hash scan max file size (bytes)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_BLOCK_MEMORY_UPLOADS": {
      "context": "multisite",
      "default": "no",
      "help": "Block uploads that are buffered in memory instead of files (cannot scan memory uploads)",
      "id": "malware-scan-block-memory",
      "label": "Block memory uploads",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CLEANUP_FILES": {
      "context": "multisite",
      "default": "yes",
      "help": "Automatically delete temporary files after scanning",
      "id": "malware-scan-cleanup",
      "label": "Cleanup temp files",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CLEANUP_ORPHANED": {
      "context": "multisite",
      "default": "no",
      "help": "Clean up orphaned temporary files on worker start",
      "id": "malware-scan-cleanup-orphaned",
      "label": "Cleanup orphaned files",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_CLEANUP_AGE": {
      "context": "multisite",
      "default": "3600",
      "help": "Maximum age (in seconds) for temporary files before cleanup",
      "id": "malware-scan-cleanup-age",
      "label": "Cleanup age (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_CACHE_TTL": {
      "context": "multisite",
      "default": "3600",
      "help": "Cache duration (in seconds) for hash-based scan results (VirusTotal, ThreatFox, SentinelOne). Lower values provide faster response to new threats during outbreaks, higher values reduce API calls. Default: 1 hour (3600 seconds).",
      "id": "malware-scan-cache-ttl",
      "label": "Hash scan cache TTL (seconds)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_USE_VIRUSTOTAL": {
      "context": "multisite",
      "default": "no",
      "help": "Enable VirusTotal API integration for cloud-based scanning. Can be used together with ClamAV (dual-layer) or independently (VirusTotal-only mode by disabling ClamAV)",
      "id": "malware-scan-use-virustotal",
      "label": "Enable VirusTotal",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_SKIP_OTHERS_ON_CLAMAV_DETECT": {
      "context": "multisite",
      "default": "yes",
      "help": "Skip cloud scanner checks (ThreatFox, VirusTotal, SentinelOne) if ClamAV already detected malware (faster blocking). Disable to get additional cloud analysis even after ClamAV detection.",
      "id": "malware-scan-skip-others-clamav",
      "label": "Skip cloud scanners if ClamAV detects",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_VIRUSTOTAL_API_KEY": {
      "context": "global",
      "default": "",
      "help": "VirusTotal API key for authentication",
      "id": "malware-scan-virustotal-api-key",
      "label": "VirusTotal API key",
      "regex": "^.*$",
      "type": "password"
    },
    "MALWARE_SCAN_VIRUSTOTAL_SUSPICIOUS": {
      "context": "global",
      "default": "5",
      "help": "Minimum number of suspicious reports before considering file as malicious",
      "id": "malware-scan-virustotal-suspicious",
      "label": "Suspicious threshold",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_VIRUSTOTAL_MALICIOUS": {
      "context": "global",
      "default": "3",
      "help": "Minimum number of malicious reports before considering file as malicious",
      "id": "malware-scan-virustotal-malicious",
      "label": "Malicious threshold",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_VT_UPLOAD_UNKNOWN": {
      "context": "multisite",
      "default": "no",
      "help": "Upload file to VirusTotal if ClamAV detects malware but the file is unknown to VirusTotal (not in their database). Helps improve VirusTotal's malware database.",
      "id": "malware-scan-vt-upload-unknown",
      "label": "Upload unknown malware to VT",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_VT_AUTO_VOTE": {
      "context": "multisite",
      "default": "no",
      "help": "Automatically vote on files uploaded to VirusTotal. If a file was uploaded (unknown to VT) and ClamAV detected it as malware, automatically add a 'malicious' vote.",
      "id": "malware-scan-vt-auto-vote",
      "label": "Auto-vote on uploaded files",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_VT_MAX_UPLOAD_SIZE": {
      "context": "multisite",
      "default": "33554432",
      "help": "Maximum file size (in bytes) for uploading to VirusTotal. Default is 32MB (33554432 bytes), which is VirusTotal's limit for standard API.",
      "id": "malware-scan-vt-max-upload-size",
      "label": "Max VT upload size (bytes)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_SHARE_FILES": {
      "context": "multisite",
      "default": "no",
      "help": "Share detected malware files with threat intelligence platforms (currently VirusTotal) when any scanner (ClamAV, ThreatFox, SentinelOne) detects malware but the file is unknown to the platform. Helps improve global threat intelligence. Requires VirusTotal integration to be enabled. Only real malware is shared, not PUA.",
      "id": "malware-scan-share-files",
      "label": "Share detected malware files",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_USE_THREATFOX": {
      "context": "multisite",
      "default": "no",
      "help": "Enable ThreatFox (abuse.ch) API integration for IOC lookup. Checks file hashes against known malware indicators. Can be used together with ClamAV and VirusTotal for multi-layer protection.",
      "id": "malware-scan-use-threatfox",
      "label": "Enable ThreatFox",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_THREATFOX_API_KEY": {
      "context": "global",
      "default": "",
      "help": "ThreatFox API key for authentication (REQUIRED). Get your free key from https://auth.abuse.ch/",
      "id": "malware-scan-threatfox-api-key",
      "label": "ThreatFox API key",
      "regex": "^.*$",
      "type": "password"
    },
    "MALWARE_SCAN_USE_SENTINELONE": {
      "context": "multisite",
      "default": "no",
      "help": "Enable SentinelOne API integration for threat intelligence lookup. Checks file hashes against SentinelOne's threat database. Can be used together with ClamAV, VirusTotal, and ThreatFox for multi-layer protection.",
      "id": "malware-scan-use-sentinelone",
      "label": "Enable SentinelOne",
      "regex": "^(yes|no)$",
      "type": "check"
    },
    "MALWARE_SCAN_SENTINELONE_MANAGEMENT_URL": {
      "context": "global",
      "default": "",
      "help": "SentinelOne Management Console URL (e.g., https://your-console.example.com). Required for SentinelOne integration.",
      "id": "malware-scan-sentinelone-url",
      "label": "SentinelOne Console URL",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_SENTINELONE_API_TOKEN": {
      "context": "global",
      "default": "",
      "help": "SentinelOne API token for authentication (REQUIRED). Generate from Console: POST /web/api/v2.0/users/generate-api-token",
      "id": "malware-scan-sentinelone-api-token",
      "label": "SentinelOne API token",
      "regex": "^.*$",
      "type": "password"
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
    },
    "MALWARE_SCAN_TEAMS_WEBHOOK_URL": {
      "context": "global",
      "default": "",
      "help": "Microsoft Teams webhook URL for malware detection notifications. Get webhook URL from Teams: Channel > Connectors > Incoming Webhook. Leave empty to disable Teams notifications.",
      "id": "malware-scan-teams-webhook-url",
      "label": "MS Teams Webhook URL",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_TEAMS_WEBHOOK_RATE_LIMIT": {
      "context": "global",
      "default": "6",
      "help": "Maximum number of Teams webhook notifications per minute (default: 6). Prevents webhook spam during malware attacks. Hard capped at 200/min (Microsoft Teams limit). Set to 0 for unlimited (still respects hard cap).",
      "id": "malware-scan-teams-webhook-rate-limit",
      "label": "MS Teams rate limit (per minute)",
      "regex": "^\\d+$",
      "type": "text"
    },
    "MALWARE_SCAN_DISCORD_WEBHOOK_URL": {
      "context": "global",
      "default": "",
      "help": "Discord webhook URL for malware detection notifications. Get webhook URL from Server Settings -> Integrations -> Webhooks in Discord. Can be used together with Teams webhooks. Leave empty to disable Discord notifications.",
      "id": "malware-scan-discord-webhook-url",
      "label": "Discord Webhook URL",
      "regex": "^.*$",
      "type": "text"
    },
    "MALWARE_SCAN_DISCORD_WEBHOOK_RATE_LIMIT": {
      "context": "global",
      "default": "5",
      "help": "Maximum number of Discord webhook notifications per 60 seconds (default: 5). Prevents webhook spam during malware attacks. Hard capped at 30 per 60s (Discord limit). Set to 0 for unlimited (still respects hard cap).",
      "id": "malware-scan-discord-webhook-rate-limit",
      "label": "Discord rate limit (per 60s)",
      "regex": "^\\d+$",
      "type": "text"
=======
>>>>>>> parent of 36bf82d (add MS Teams webhook)
=======
>>>>>>> parent of 36bf82d (add MS Teams webhook)
=======
>>>>>>> parent of 36bf82d (add MS Teams webhook)
    }
  }
}
