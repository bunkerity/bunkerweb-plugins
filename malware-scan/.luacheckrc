-- Luacheck configuration for BunkerWeb malware-scan plugin
-- https://luacheck.readthedocs.io/en/stable/config.html

std = "lua54"  -- Lua 5.4 standard library

-- Global variables provided by BunkerWeb and OpenResty
globals = {
    "ngx",           -- OpenResty/nginx Lua module
    "package",       -- Lua package module
    "require",       -- Lua require function
    "pcall",         -- Protected call
    "pairs",         -- Iterator
    "ipairs",        -- Iterator
    "tonumber",      -- Type conversion
    "tostring",      -- Type conversion
    "type",          -- Type checking
    "os",            -- OS module
    "io",            -- IO module
    "string",        -- String module
    "table",         -- Table module
    "math",          -- Math module
}

-- Ignore unused arguments (common in BunkerWeb plugin API)
-- The plugin API often requires specific function signatures even if not all params are used
ignore = {
    "211",  -- Unused local variable
    "212",  -- Unused argument
    "213",  -- Unused loop variable
    "311",  -- Value assigned to variable is unused (common in module returns)
    "314",  -- Value of field is unused
}

-- Allow longer lines for configuration strings and help text
max_line_length = 200

-- Allow underscores in variable names (common Lua convention)
allow_defined = true

-- Files to exclude from checks
exclude_files = {
    ".tests/**",
    "_upstream/**",
    "broken/**",
}

-- Enable specific warnings
-- enable = {"011"}  -- Enforce consistent indentation (disabled for performance)

-- Relaxed settings for specific files
files["malware-scan.lua"] = {
    max_line_length = 250,  -- Main orchestration file has longer lines
}

files["malware_scan_*.lua"] = {
    ignore = {"431"},  -- Allow shadowing of upvalues (modules use similar patterns)
}
