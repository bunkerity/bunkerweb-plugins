# Security Policy

## Vulnerability Reporting

If you discover a security vulnerability in the BunkerWeb malware-scan plugin, please report it responsibly:

1. **Do NOT** open a public GitHub issue
2. Email security details to both: 
 security [@] bunkerity.com (BunkerWeb)
 mkf [@] sysangels.ai (the main dev of this module)
3. Include:
   - Description of the vulnerability
   - Steps to reproduce
   - Potential impact
   - Suggested fix (if available)

We will respond within 48 hours and work with you to address the issue.

## Security Best Practices

### Configuration Hardening

1. **API Keys**: Store in environment variables, never commit to git
2. **ClamAV**: Keep virus signatures updated (`freshclam`)
3. **File Validation**: Keep `BLOCK_ON_FILENAME_INJECTION_ATTACK=yes` (default)
4. **Resume Mode**: Only enable `RESUME_SCAN_ON_FIRST_HIT` for research (DOS risk)
5. **Webhooks**: Mask URLs in logs (leave `UNMASK_KEYS` empty)

### Network Security

- ClamAV should only listen on `127.0.0.1` (localhost)
- Redis should require authentication if exposed
- API calls use HTTPS for VirusTotal, SentinelOne
- Webhook URLs should be kept confidential

### File System Security

- Temporary files use `os.tmpname()` with restrictive permissions
- Files cleaned up after scanning (`CLEANUP_FILES=yes`)
- Never trust attacker-provided filenames (validated by `utils.validate_filename()`)

### Log Injection Protection

All user-provided strings are sanitized before logging:
- Filenames: `utils.sanitize_for_logging()` escapes control characters
- Prevents newline injection, ANSI escape codes, null bytes
- Limits log message length to prevent flooding

### Input Validation

Multiple layers of validation:
1. **Filename validation**: Path traversal, null bytes, excessive length
2. **File size limits**: ClamAV max 25MB, hash scanning max 64MB
3. **Content-Type validation**: Boundary extraction from multipart uploads
4. **SHA256 verification**: Hash-based deduplication and cache lookups

## Security Features

### Defense in Depth

- **Multi-layer scanning**: Local (ClamAV) + Cloud (VT, S1)
- **Dual scanning mode**: Whole-body + per-file scanning
- **Cache validation**: Differential TTL (clean: 5min, malicious: 24h)
- **Filename attack detection**: 8 separate validation checks

### Monitoring & Alerting

- Webhook notifications (Discord, Teams)
- Attacker IP tracking
- Per-file detection reports
- Cache hit/miss metrics

---

**Last Updated**: 2026-01-27
